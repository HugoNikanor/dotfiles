;;; -*- mode: scheme -*-


;; maybe install modules in /usr/lib or simmilar
(let ((home (getenv "HOME")))
  (for-each
    (lambda (path-part)
      (add-to-load-path (string-append home path-part)))
    '("/lib/guile" "/code/guile")))

(use-modules (ice-9 pretty-print)
             (language tree-il)
             (output line)
             (macros arrow))


(define-macro (l file)
  "Macro for quicker file loading"
  `(load ,(string-append
            (symbol->string file)
            ".scm")))

(define-syntax thunk
  (syntax-rules ()
    ((_ body ...)
     (lambda () body ...))))

(define (expand-filepath path)
  "Expands a '~' at the start of a filepath into /home/<user>
  Note that '~<otheruser>/' doesn't work"
  (regexp-substitute #f (string-match "^~" path)
                     (getenv "HOME") 'post))

(define* (to-file expr #:optional (filename "/tmp/guile-output")
                                  (displayfunc displayln))
  "Write expr to a file, with an optional display func"
  (with-output-to-file (expand-filepath filename)
    (thunk
      (displayfunc expr))))

(define mac-exp (compose pretty-print tree-il->scheme macroexpand))

(use-modules (ice-9 readline))
(activate-readline)


;;; vim: filetype=scheme
